<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Aqua Real Estate — AI + Savings</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <header>
    <nav class="nav">
      <a href="/">Aqua Real Estate</a>
      <a href="/listings.html">Listings</a>
      <a href="/about.html">About</a>
      <a href="/contact.html">Contact</a>
    </nav>
  </header>

  <main class="wrap">
    <h1>Smarter Home Buying with AI + Savings</h1>
    <p class="muted">Ask about neighborhoods, budgets, and programs. Estimate your buyer savings instantly.</p>

    <!-- Savings Calculator -->
    <section class="card">
      <h2 style="margin-top:0">Buyer-Savings Calculator</h2>
      <div class="row">
        <label>Home Price <input id="price" type="number" value="900000" inputmode="numeric"></label>
        <label>Share (0–1) <input id="share" type="number" step="0.05" value="0.3" inputmode="decimal"></label>
      </div>
      <p id="savings" style="font-weight:700;font-size:22px;margin:12px 0 0"></p>
      <div class="muted" style="font-size:12px;margin-top:6px">Assumes 2.5% buyer-agent commission. Not a guarantee; program terms apply.</div>
    </section>

    <!-- AI Chat -->
    <section class="card">
      <h2 style="margin-top:0">AI Home Assistant</h2>
      <div id="chat" class="chat"></div>
      <div class="row">
        <input id="input" placeholder="Ask about Bellevue vs Sammamish, budgets, or closing costs…" style="flex:1;min-width:220px">
        <button id="send">Send</button>
      </div>
      <div class="muted" style="font-size:12px;margin-top:6px">Tip: “4-bed under $1.2M near parks — Bellevue vs Sammamish pros/cons?”</div>
    </section>

    <footer>
      © <span id="year"></span> Aqua Real Estate · Bellevue, WA — Built with Vercel
    </footer>
  </main>

  <script>
    // Savings calculator
    const priceEl = document.getElementById('price');
    const shareEl = document.getElementById('share');
    const savingsEl = document.getElementById('savings');
    const COMMISSION = 0.025;
    function renderSavings(){
      const price = Number(priceEl.value) || 0;
      let share = Number(shareEl.value);
      if(!Number.isFinite(share)) share = 0;
      share = Math.min(1, Math.max(0, share));
      const savings = Math.max(0, price * COMMISSION * share);
      savingsEl.textContent = '$' + savings.toLocaleString() + ' estimated savings';
    }
    priceEl.addEventListener('input', renderSavings);
    shareEl.addEventListener('input', renderSavings);
    renderSavings();
    document.getElementById('year').textContent = new Date().getFullYear();

    // Simple chat
    const chatEl = document.getElementById('chat');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const messages = [{ role:'assistant', content:'Hi! I can compare areas, estimate savings, and plan your search.' }];

    function pushBubble(role, content){
      const d = document.createElement('div'); d.className = 'bubble' + (role==='user' ? ' me' : '');
      d.textContent = content; chatEl.appendChild(d); chatEl.scrollTop = chatEl.scrollHeight;
    }
    pushBubble('assistant', messages[0].content);

    async function send(){
      const text = inputEl.value.trim();
      if(!text) return;
      messages.push({ role:'user', content:text });
      pushBubble('user', text);
      inputEl.value = '';
      try{
        const r = await fetch('/api/chat', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ messages: messages.slice(-8) })
        });
        const data = await r.json();
        const reply = data.reply || 'Try again later.';
        messages.push({ role:'assistant', content: reply });
        pushBubble('assistant', reply);
      }catch(e){
        pushBubble('assistant', 'Network error — please try again.');
      }
    }
    sendBtn.addEventListener('click', send);
    inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') send(); });
  </script>
</body>
</html>
